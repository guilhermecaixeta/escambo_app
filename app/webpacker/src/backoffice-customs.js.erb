import { read } from "@popperjs/core";
import Chart from "chart.js/auto";
import { DataTable } from "simple-datatables.min.js";

// based on this code https://stackoverflow.com/questions/799981/document-ready-equivalent-without-jquery
var ready = fn => document.readyState !== 'loading' ?
    fn() :
    document.addEventListener('turbolinks:load', fn);

window.ready = ready;

// Loads the charts on the dashboard. example will be removed!
ready(() => {
    if (document.getElementById("line_chart")) {
        let ctx = document.getElementById("line_chart").getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: {
                // labels: JSON.parse(ctx.canvas.dataset.labels),

                labels: ["Jan", "Feb", "Mar"],
                datasets: [{
                    // data: JSON.parse(ctx.canvas.dataset.data),
                    data: [10, 25, 5]
                }]
            }
        });
    }

    if (document.getElementById("datatablesSimple")) {
        new DataTable("#datatablesSimple");
    }
});

// Display errors in form when remote: 'true'.
// To see more: https://github.com/turbolinks/turbolinks/issues/85#issuecomment-338784510
// https://stackoverflow.com/questions/57935148/rails-6-form-with-remote-true-and-turbolinks-not-showing-flash-after-redirect
document.addEventListener('ajax:complete', function (event) {
    var xhr = event.detail[0]
    if ((xhr.getResponseHeader('Content-Type') || '').substring(0, 9) === 'text/html') {
        var referrer = window.location.href
        var snapshot = Turbolinks.Snapshot.wrap(xhr.response)
        Turbolinks.controller.cache.put(referrer, snapshot)
        Turbolinks.visit(referrer, { action: 'restore' })
    }
}, false)